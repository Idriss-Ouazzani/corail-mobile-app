# Databricks Apps Configuration pour Corail Backend
bundle:
  name: corail-backend

resources:
  apps:
    corail_api:
      name: corail-api
      description: "Backend API pour Corail VTC - FastAPI + Firebase Auth"
      
      resources:
        - name: backend
          description: "FastAPI backend with Firebase authentication"
          source_code_path: ./app
          
      # Configuration de l'app
      config:
        command:
          - "uvicorn"
          - "app.main:app"
          - "--host"
          - "0.0.0.0"
          - "--port"
          - "8000"
        
        env:
          - name: DATABRICKS_HOST
            value: "${var.databricks_host}"
          - name: DATABRICKS_HTTP_PATH
            value: "${var.http_path}"
          - name: DATABRICKS_TOKEN
            value: "${var.databricks_token}"
          - name: CATALOG
            value: "io_catalog"
          - name: SCHEMA
            value: "corail"
          - name: FIREBASE_CREDENTIALS_PATH
            value: "/app/firebase-key.json"

# Variables (à définir dans databricks.tfvars ou via CLI)
variables:
  databricks_host:
    description: "Databricks workspace hostname"
  
  http_path:
    description: "SQL Warehouse HTTP path"
  
  databricks_token:
    description: "Databricks access token"
    sensitive: true


